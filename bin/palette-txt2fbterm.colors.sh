#!/bin/sh
BN=`pwd`
BN=`basename "$BN"`
if [ "$1" = "" -o "$1" = "--help" ]; then
  echo "txt2fbterm.colors"
  echo "Pre-processed text (.txt) to ShellBASIC (bas) color palettes  (.sh)"
  echo "usage: txt2fbterm.colors.sh [--help]|[do]"
  echo "notes: './$BN.fbterm.colors' "
  echo "       will be over written."
  echo "requires: "
  echo "       './$BN-names-CAPS_.txt'"
  echo "       './$BN-dec-24-semi-colon.txt'"
  exit 0
fi
if [ ! "$1" = "do" ]; then
  echo "Error: txt2fbterm.colors.sh [--help]|[do]"
  exit 1
fi

# make sure we have all the required files
if [ ! -f "./${BN}-names-CAPS_.txt" ]; then
  echo "Error: file not found: './${BN}-names-CAPS_.txt'"
  exit 2
fi
if [ ! -f "./${BN}-dec-24-semi-colon.txt" ]; then
  echo "Error: file not found: './${BN}-dec-24-semi-colon.txt'"
  exit 2
fi

PN=`echo "$BN" | sed 's/HW-//g'`
CN=`grep -c -E "^[0-9]" "./${BN}-dec-24-semi-colon.txt"`

### setup and check
cat > "./${BN}.fbterm.colors.0" <<EOF
#!/bin/sh
# generated by:
#  programmers-palettes
#  txt2fbterm.colors.sh
#  https://github.com/paulwratt/programmers-palettes/tree/master/bin

if echo "\$TERM" | grep "fbterm" > /dev/null; then
    t_SETCOLOR='\033[3;%d;%s}';  # for printf
    # fbterm uses decimal values in tput/ESC codes for 256 colors
    # COLOR 0 is the transparencey (background image) color
EOF
echo "t_COLOR0" > ./temp.10
for i in `seq 1 ${CN}`; do
  if [ $i -ne $CN ]; then
    echo "t_COLOR$i" >> ./temp.10
  fi
done
cat "./${BN}-dec-24-semi-colon.txt" | xargs printf "::%s::;\n" > ./temp.11
paste -d= ./temp.10 ./temp.11 > ./temp.12
cat "./${BN}-names-CAPS_.txt" | xargs printf 't_%s\n' > ./temp.13
paste -d= ./temp.13 ./temp.11 > ./temp.14
paste -d\  ./temp.12 ./temp.14 > ./temp.15
cat ./temp.15 | xargs printf '    %-30s%s\n' > ./temp.1
cat ./temp.1 >> "./${BN}.fbterm.colors.0"

### the end
echo "fi" >> "./${BN}.fbterm.colors.0"

cat "./${BN}.fbterm.colors.0" | sed 's/::/\"/g' > "${BN}.fbterm.colors"
rm -f ./temp.*
rm -f "./${BN}.fbterm.colors.0"

echo "$CN colors written to '${BN}.fbterm.colors'"

unset CN
unset PN
unset BN
exit 0
